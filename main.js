(()=>{"use strict";class e{constructor({data:e,handleCardClick:t,handleLikeClickActive:s,handleLikeClickDeactive:i,handleDeleteClick:r},n,a){this._name=e.name,this._image=e.link,this._likes=e.likes,this._likesCount=e.likes.length,this._template=n,this.handleCardClick=t,this.handleLikeClickActive=s,this.handleLikeClickDeactive=i,this.handleDeleteClick=r,this._userId=a,this._ownerId=e.owner._id,this._id=e._id}_getTempalte(){return this._template.content.querySelector(".element").cloneNode(!0)}_setEventListeners(){this._elementCard.querySelector(".element__like-button").addEventListener("click",(e=>{this._handleLikeClick(e)})),this._cardImage.addEventListener("click",(()=>{this.handleCardClick()})),this._userId===this._ownerId&&this._elementCard.querySelector(".element__delete-button").addEventListener("click",this.handleDeleteClick)}handleDelete(){this._elementCard.remove(),this._elementCard=""}createCard(){return this._elementCard=this._getTempalte(),this._cardImage=this._elementCard.querySelector(".element__pic"),this._cardName=this._elementCard.querySelector(".element__name"),this._cardLikes=this._elementCard.querySelector(".element__like-count"),this._setEventListeners(),this._cardName.textContent=this._name,this._cardImage.src=this._image,this._cardImage.alt=this._name,this._cardLikes.textContent=this._likesCount,this._addLikes(this._userId),this._removeDeleteButton(this._userId),this._elementCard}countLikes=e=>{this._cardLikes.textContent=e};_handleLikeClick(e){const t=this._elementCard.querySelector(".element__like-button");e.target.classList.contains("element__like-button_acive")?(this.handleLikeClickDeactive(this._id,this.countLikes),t.classList.remove("element__like-button_acive")):(this.handleLikeClickActive(this._id,this.countLikes),t.classList.add("element__like-button_acive"))}_addLikes(e){this._likes.forEach((t=>{t._id===e&&this._elementCard.querySelector(".element__like-button").classList.add("element__like-button_acive")}))}_removeDeleteButton(e){this._ownerId!==e&&(this._elementCard.querySelector(".element__delete-button").style.display="none")}}const t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_activate"};class s{constructor(e,t){this._formElement=t,this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._inputList=[...t.querySelectorAll(this._inputSelector)],this._buttonElement=t.querySelector(this._submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector(`.popup__input-error_${e.id}`);e.classList.add(this._inputErrorClass),s.textContent=t,s.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`.popup__input-error_${e.id}`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.disabled=!0,this._buttonElement.classList.add(this._inactiveButtonClass)):(this._buttonElement.disabled=!1,this._buttonElement.classList.remove(this._inactiveButtonClass))}_setEventListeners=()=>{this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))};enableValidation=()=>{this._formElement.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()};resetValidation(){this._toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}}class i{constructor(e){this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_is-opened"),document.addEventListener("keydown",this._handleEscClose),this._popup.addEventListener("click",this._handleOverlayClose)}close(){this._popup.classList.remove("popup_is-opened"),document.removeEventListener("keydown",this._handleEscClose),this._popup.removeEventListener("click",this._handleOverlayClose)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};_handleOverlayClose=e=>{e.target===e.currentTarget&&this.close()};setEventListeners(){this._popup.querySelector(".popup__button-close").addEventListener("click",(()=>{this.close()}))}}class r extends i{constructor(e,t){super(e),this._submiter=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=[...this._popup.querySelectorAll(".popup__input")]}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._submiter(this._getInputValues())}))}close(){super.close(),this._form.reset()}}const n=".popup_type_edit",a=document.querySelector(".profile__edit-button"),o=document.forms["form-edit"],l=document.forms["form-card"],c=document.forms["form-avatar"],h=o.querySelector(".popup__input_type_name"),_=o.querySelector(".popup__input_type_description"),d=document.querySelector(".elements"),u=document.querySelector(".element-template"),p=".popup_type_card",m=document.querySelector(".profile__add-button"),v=".popup_type_avatar",C=document.querySelector(".profile__pic"),k=(e,t=!1)=>{document.querySelector(`${e} .popup__button-save`).textContent=t?"Загрузка...":"Сохранить"};let L;const f=new class{constructor({name:e,description:t,avatar:s}){this._name=document.querySelector(e),this._description=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._name.textContent,description:this._description.textContent}}setUserInfo({fullname:e,description:t,avatar:s}){e&&(this._name.textContent=e),t&&(this._description.textContent=t),s&&(this._avatar.src=s)}}({name:".profile__name",description:".profile__description",avatar:".profile__pic"}),E=new class{constructor(e){this._url=e.url,this._headers=e.headers,this._body=e.body}_prepareDate=e=>e.ok?e.json():Promise.reject(e.status);getProfileData(){return fetch(`${this._url}users/me`,{headers:this._headers}).then((e=>this._prepareDate(e)))}editProfile(e,t){return fetch(`${this._url}users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>this._prepareDate(e)))}editAvatar(e){return fetch(`${this._url}users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>this._prepareDate(e)))}getCardsData(){return fetch(`${this._url}cards`,{headers:this._headers}).then((e=>this._prepareDate(e)))}addNewCard(e,t){return fetch(`${this._url}cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>this._prepareDate(e)))}deleteCard(e){return fetch(`${this._url}cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>this._prepareDate(e)))}0;putCardLikes(e){return fetch(`${this._url}cards/${e}/likes`,{method:"PUT",headers:this._headers}).then((e=>this._prepareDate(e)))}deleteCardLikes(e){return fetch(`${this._url}cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then((e=>this._prepareDate(e)))}}({url:"https://nomoreparties.co/v1/cohort-33/",headers:{authorization:"4ceab365-cfce-44b4-ad76-98caf2999b9a","content-type":"application/json"}}),y=E.getProfileData(),b=E.getCardsData(),S=new r(n,(e=>{k(n,!0),E.editProfile(e.fullname,e.description).then((e=>{f.setUserInfo({fullname:e.name,description:e.about,avatar:e.avatar}),S.close()})).catch((e=>{alert(`Возникла ошибка: ${e}`)})).finally((()=>{k(n,!1)}))}));S.setEventListeners();const I=new s(t,o);I.enableValidation(),a.addEventListener("click",(function(){S.open();const e=f.getUserInfo();h.value=e.name,_.value=e.description,I.resetValidation()}));const g=new class extends i{constructor(e){super(e),this._title=this._popup.querySelector(".popup__title-pic"),this._link=this._popup.querySelector(".popup__pic")}open({name:e,link:t}){super.open(),this._title.textContent=e,this._link.src=t,this._title.alt=e}}(".popup_type_pic");g.setEventListeners();const q=new class extends i{constructor(e){super(e)}submit(e){this._submiter=e}setEventListeners(){super.setEventListeners(),this._popup.addEventListener("submit",(e=>{e.preventDefault(),this._submiter(),this.close()}))}}(".popup_type_card-delete");q.setEventListeners();const D=(e,t)=>{E.putCardLikes(e).then((e=>{t(e.likes.length)})).catch((e=>{alert(`Возникла ошибка: ${e}`)}))},w=(e,t)=>{E.deleteCardLikes(e).then((e=>{t(e.likes.length)})).catch((e=>{alert(`Возникла ошибка: ${e}`)}))};function $(t,s){const i=new e({data:t,handleCardClick:()=>{g.open(t)},handleLikeClickActive:D,handleLikeClickDeactive:w,handleDeleteClick:()=>{q.open(),q.submit((()=>{E.deleteCard(t._id).then((()=>{i.handleDelete()})).catch((e=>{alert(`Возникла ошибка: ${e}`)}))}))}},s,L);return i.createCard()}const V=new class{constructor({renderer:e},t){this._renderer=e,this._container=t}renderItems(e){e.forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({renderer:e=>{const t=$(e,u);V.addItem(t)}},d);Promise.all([b,y]).then((e=>{L=e[1]._id,y.then((e=>{f.setUserInfo({fullname:e.name,description:e.about,avatar:e.avatar})})).catch((e=>{alert(`Возникла ошибка: ${e}`)})),b.then((e=>(V.renderItems(e),V))).catch((e=>{alert(`Возникла ошибка: ${e}`)}))}));const x=new s(t,l);x.enableValidation();const B=new r(p,(e=>{k(p,!0),E.addNewCard(e.name,e.link).then((e=>{const t=$(e,u);V.addItem(t),B.close()})).catch((e=>{alert(`Возникла ошибка: ${e}`)})).finally((()=>{k(p,!1)}))}));B.setEventListeners(),m.addEventListener("click",(function(){B.open(),x.resetValidation()}));const A=new s(t,c);A.enableValidation();const P=new r(v,(e=>{k(v,!0),E.editAvatar(e.link).then((e=>{f.setUserInfo({fullname:e.name,description:e.about,avatar:e.avatar}),P.close()})).catch((e=>{alert(`Возникла ошибка: ${e}`)})).finally((()=>{k(v,!1)}))}));P.setEventListeners(),C.addEventListener("click",(function(){A.resetValidation(),P.open()}))})();